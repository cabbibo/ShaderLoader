<html>

  <head>
    <style>
      body{ margin: 0px; }
    </style>
  </head>

  <body>

    <script src="lib/three.min.js"></script>
    <script src="lib/jquery.min.js"></script>
    <script src="lib/TrackballControls.js"></script>
    <script src="lib/DeviceOrientationControls.js"></script>
    <script src="lib/StereoEffect.js"></script>
    
    <script src="../ShaderLoader.js"></script>

    <script>


      var uniforms = {
        time:{type:"f",value:0}
      }

      var camera, renderer, scene , controls, clock;

      var effect;

      var vs, fs;

      var geometry, material , light;


      var shaders = new ShaderLoader( '../shaders' , '../shaderChunks' );

      shaders.shaderSetLoaded = function(){
        init();
        animate();
      }

      shaders.load( 'vs-displacement' , 'displacement' , 'vertex' );
      shaders.load( 'fs-displacement' , 'displacement' , 'fragment' );

      //document.body.requestFullscreen();

      function init(){

        var w = window.innerWidth;
        var h = window.innerHeight;

        clock = new THREE.Clock();

        camera = new THREE.PerspectiveCamera( 65 , w/h , 1 , 2000 );
        camera.position.z = 1000;

        controls = new THREE.DeviceOrientationControls( camera, true);
        scene = new THREE.Scene();

      
        geometry = new THREE.IcosahedronGeometry( 200, 6 );
        geometry.computeVertexNormals();
        
        material = new THREE.ShaderMaterial({

          uniforms:uniforms,
          vertexShader:   shaders.vertexShaders.displacement,
          fragmentShader: shaders.fragmentShaders.displacement,
          side: THREE.DoubleSide

        });
       
        mesh = new THREE.Mesh( geometry, material );
        scene.add( mesh );

        var skybox = mesh.clone();

        skybox.scale.multiplyScalar( 8 );
        scene.add( skybox);



        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );

        effect = new THREE.StereoEffect( renderer );
        effect.setSize( window.innerWidth, window.innerHeight );
        effect.separation = 90;

        renderer.domElement.addEventListener('click', function(){

          if( renderer.domElement.requestFullscreen) {
            renderer.domElement.requestFullscreen();
          } else if (renderer.domElement.msRequestFullscreen) {
            renderer.domElement.msRequestFullscreen();
          } else if (renderer.domElement.mozRequestFullScreen) {
            renderer.domElement.mozRequestFullScreen();
          } else if (renderer.domElement.webkitRequestFullscreen) {
            renderer.domElement.webkitRequestFullscreen();
          }else{
            alert('none');
          }
          
        } , false);
       

        window.addEventListener('deviceorientation', initControls, false);
       // renderer.domElement.requestFullscreen();

        document.body.appendChild( renderer.domElement );
        
        window.addEventListener( 'resize', onWindowResize, false );

      }


      function initControls(){

        controls.connect();

      }


      function onWindowResize() {

          windowHalfX = window.innerWidth / 2,
          windowHalfY = window.innerHeight / 2,

          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();

          effect.setSize( window.innerWidth, window.innerHeight );

      }

      function animate(){

        requestAnimationFrame( animate );
        
        uniforms.time.value += clock.getDelta();
        controls.update();
        //renderer.render( scene , camera );

        effect.render( scene , camera );

      }

    </script>

  </body>
</html>
